@inherits LayoutComponentBase
@namespace HospitalSystemTeamTask.Shared.Layouts
@inject NavigationManager NavigationManager
@inject AuthenticationStateProvider AuthStateProvider

<MudThemeProvider />
<MudPopoverProvider />
<MudDialogProvider />
<MudSnackbarProvider />

<div class="page d-flex flex-column" style="min-height: 100vh;">
    <!-- AppBar Section -->
    <MudAppBar Color="Color.Default" Fixed="true" Style="background-color: #1B7D84;">
        <MudText Typo="Typo.body1" Align="Align.Center" Style="color: white; margin-right: auto;">
            @if (!string.IsNullOrEmpty(UserName))
            {
                <span>Hello, @UserName!</span>
            }
        </MudText>
        <MudSpacer />
        <MudMenu>
            <ActivatorContent>
                <MudChip T="string" Icon="@Icons.Material.Filled.Person" Style="color: #ffffff;"></MudChip>
            </ActivatorContent>
            <ChildContent>
                <MudMenuItem OnClick="NavigateToProfile">Profile</MudMenuItem>
                <MudMenuItem OnClick="NavigateToSettings">Settings</MudMenuItem>
                <MudMenuItem OnClick="Logout">Logout</MudMenuItem>
            </ChildContent>
        </MudMenu>
    </MudAppBar>

    <!-- Main Content Section -->
    <div class="d-flex" style="flex: 1; margin-top: 65px;">
        <!-- Sidebar -->
        <div style="background: linear-gradient(to bottom, #1B7D84, #33BEC8); color: white; width: 250px; height: calc(100vh - 65px); padding: 1rem;">
            <div class="text-center">
                <img src="/Images/logo.png" alt="Logo" style="max-width: 150px; object-fit: contain;" />
            </div>
            <nav>
                <NavLink class="nav-link d-flex align-items-center" href="/" Match="NavLinkMatch.All" style="color: white; font-weight: bold; font-size: 1.1rem; padding: 0.5rem;">
                    <span class="bi bi-house-door-fill" aria-hidden="true" style="margin-right: 15px;"></span> Home
                </NavLink>
                <NavLink class="nav-link d-flex align-items-center" href="/ManageBranch" style="color: white; font-weight: bold; font-size: 1.1rem; padding: 0.5rem;">
                    <span class="bi bi-building" aria-hidden="true" style="margin-right: 15px;"></span> Branch
                </NavLink>
                <NavLink class="nav-link d-flex align-items-center" href="/DepartmentPage" style="color: white; font-weight: bold; font-size: 1.1rem; padding: 0.5rem;">
                    <span class="bi bi-journal-bookmark-fill" aria-hidden="true" style="margin-right: 15px;"></span> Department
                </NavLink>
                <NavLink class="nav-link d-flex align-items-center" href="/ClinicPage" style="color: white; font-weight: bold; font-size: 1.1rem; padding: 0.5rem;">
                    <span class="bi bi-hospital-fill" aria-hidden="true" style="margin-right: 15px;"></span> Clinic
                </NavLink>
                <NavLink class="nav-link d-flex align-items-center" href="/Staff" style="color: white; font-weight: bold; font-size: 1.1rem; padding: 0.5rem;">
                    <span class="bi bi-person-lines-fill" aria-hidden="true" style="margin-right: 15px;"></span> Staff
                </NavLink>
            </nav>
        </div>

        <!-- Main Content -->
        <div style="flex: 1; padding: 1rem; overflow-y: auto; height: calc(100vh - 65px);">
            @Body
        </div>
    </div>
</div>

<div id="blazor-error-ui">
    An unhandled error has occurred.
    <a href="" class="reload">Reload</a>
    <a class="dismiss">🗙</a>
</div>

@code {
    private string UserName;

    protected override async Task OnInitializedAsync()
    {
        var authState = await AuthStateProvider.GetAuthenticationStateAsync();
        var user = authState.User;

        if (user.Identity != null && user.Identity.IsAuthenticated)
        {
            UserName = user.Identity.Name; // Retrieve username from claims
        }
        else
        {
            UserName = "Guest";
        }
    }

    private void NavigateToProfile()
    {
        Console.WriteLine("Navigating to profile...");
        NavigationManager.NavigateTo("/Profile");
    }

    private void NavigateToSettings()
    {
        Console.WriteLine("Navigating to settings...");
        NavigationManager.NavigateTo("/Settings");
    }

    private void Logout()
    {
        Console.WriteLine("Logging out...");
        NavigationManager.NavigateTo("/Logout");
    }
}
