@page "/AddPatientRecord/{DoctorId:int}"
@layout DoctorLayout
@inject IPatientRecordService patientRecordService
@inject NavigationManager NavigationManager
@inject ISnackbar Snackbar

<h3 style="color: #1B7D84;">Add New Patient Record</h3>

@* <MudForm @ref="form" Model="@newPatientRecord" OnValidSubmit="HandleValidSubmit">
    <MudTextField T="int" Label="Patient ID" @bind-Value="newPatientRecord.PtientID" Required="true" />
    <MudTextField T="string" Label="Treatment" @bind-Value="newPatientRecord.Treatment" Required="true" />
    <MudTextField T="string" Label="Inspection" @bind-Value="newPatientRecord.Inspection" Required="true" />

    <MudButton Type="Submit" Variant="Variant.Filled" Style="margin-top: 20px; background-color: #1B7D84; border-color: #1B7D84; color: white;">
        Save Record
    </MudButton>
</MudForm>

 *@
<MudForm Model="newPatientRecord" @ref="form" Valid="isFormValid" OnValidSubmit="HandleValidSubmit">
    <MudTextField T="int" Label="Patient ID" @bind-Value="newPatientRecord.PtientID" Required="true" />
    <MudTextField T="string" Label="Treatment" @bind-Value="newPatientRecord.Treatment" Required="true" />
    <MudTextField T="string" Label="Inspection" @bind-Value="newPatientRecord.Inspection" Required="true" />


        <MudButton Variant="Variant.Filled" Color="Color.Primary" OnClick="HandleValidSubmit" Disabled="!form.IsValid">
            Submit
        </MudButton>
       
</MudForm>

@code {
    private PatientRecordInputDTO newPatientRecord = new PatientRecordInputDTO();
    private MudForm form;

    [Parameter] public int DoctorId { get; set; }

    protected override void OnInitialized()
    {
        if (DoctorId == 0)
        {
            Snackbar.Add("Doctor ID not provided. Redirecting...", Severity.Warning);
            NavigationManager.NavigateTo("/ErrorPage");
        }
    }

    private void HandleValidSubmit()
    {
        try
        {
            // Log information for debugging
            Console.WriteLine($"DoctorId: {DoctorId}, PatientID: {newPatientRecord.PtientID}, Treatment: {newPatientRecord.Treatment}, Inspection: {newPatientRecord.Inspection}");

            // Call the service to create the patient record
            patientRecordService.CreateRecord(newPatientRecord, DoctorId);

            // Notify the user of success
            Snackbar.Add("Patient record created successfully!", Severity.Success);

            // Redirect to the patient records page
            NavigationManager.NavigateTo($"/PatientRecords/{DoctorId}");
        }
        catch (Exception ex)
        {
       
            Console.WriteLine($"Error adding patient record: {ex.Message}");

            // Notify the user of the error
            Snackbar.Add($"Error adding patient record: {ex.Message}", Severity.Error);
        }
    }
}
