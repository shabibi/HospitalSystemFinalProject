@page "/DoctorPage/{DoctorId:int}"
@layout DoctorLayout
@inject NavigationManager NavigationManager
@inject IDoctorService DoctorService
@inject IDepartmentService DepartmentService


@if (loading)
{
    <MudText Typo="Typo.body1" Align="Align.Center" Style="color: gray;">Loading doctor information...</MudText>
}
else if (DoctorDetails != null)
{
    <!-- Doctor Information Section -->
    <MudContainer MaxWidth="MaxWidth.Medium" Class="my-5">
        <MudText Typo="Typo.h3" Align="Align.Center" Style="color: #1B7D84;">@DoctorDetails.UserName</MudText>
        <MudText Typo="Typo.subtitle1" Align="Align.Center" Style="color: #33BEC8;">@DoctorDetails.Level - @CapitalizeWords(DepartmentName)</MudText>

        <MudCard Class="mt-5">
            <MudCardContent>
                <MudGrid>
                    <!-- Doctor Image -->
                    <MudItem xs="12" md="4" Class="d-flex justify-center align-center">
                        <div style="width: 100%; max-width: 200px; height: auto; overflow: hidden;">
                            <img src="@($"/Images/Users/Doctors/{DoctorDetails.UID}.webp" ?? "/Images/Users/Doctors/defaultDoctor.png")"
                                 alt="@DoctorDetails.UserName"
                                 style="width: 100%; height: auto; border-radius: 4px; border: 1px solid #ccc;" />
                        </div>
                    </MudItem>

                    <!-- Doctor Information -->
                    <MudItem xs="12" md="8">
                        <MudGrid>
                            <!-- Personal Information -->
                            <MudItem xs="12" md="12">
                                <MudDivider Class="my-2" />
                                <MudText Typo="Typo.body1"><b>Email:</b> @DoctorDetails.Email</MudText>
                                <MudText Typo="Typo.body1"><b>Phone:</b> @DoctorDetails.Phone</MudText>
                            </MudItem>

                            <!-- Professional Information -->
                            <MudItem xs="12" md="12">
                                <MudDivider Class="my-2" />
                                <MudText Typo="Typo.body1"><b>Degree:</b> @DoctorDetails.Degree</MudText>
                                <MudText Typo="Typo.body1"><b>Clinic:</b> @DoctorDetails.CurrentBrunch</MudText>
                                <MudText Typo="Typo.body1"><b>Department:</b> @CapitalizeWords(DepartmentName)</MudText>
                            </MudItem>
                        </MudGrid>
                    </MudItem>
                </MudGrid>
            </MudCardContent>
        </MudCard>
    </MudContainer>

    <!-- Buttons Section -->
    <div style="display: flex; justify-content: center; margin-top: 20px;">
        <!-- Button to view patient records -->
        <MudButton Variant="Variant.Filled" Color="Color.Primary" OnClick="NavigateToPatientRecords"
                   Style="background-color: #1B7D84; color: white; font-size: 1rem; padding: 10px 20px;">
            NEW VISIT
        </MudButton>
    </div>



}
else
{
    <MudText Typo="Typo.body1" Align="Align.Center" Style="color: gray;">Loading doctor information...</MudText>
}

@code {
    [Parameter]
    public int DoctorId { get; set; }

    private DoctorOutPutDTO DoctorDetails { get; set; }
    private string DepartmentName { get; set; }
    private bool loading = true;

    protected override async Task OnParametersSetAsync()
    {
        try
        {
            DoctorDetails = DoctorService.GetDoctorDetailsById(DoctorId);

            if (DoctorDetails != null)
            {
                DepartmentName = DepartmentService.GetDepartmentName(DoctorDetails.DepId);
            }

            loading = false;
        }
        catch (Exception ex)
        {
            Console.WriteLine($"Error fetching doctor info: {ex.Message}");
            loading = false;
        }
    }

    private void NavigateToPatientRecords()
    {
        // Navigate to the PatientRecords page with DoctorId
        NavigationManager.NavigateTo($"/PatientRecords/{DoctorId}");
    }

    private string CapitalizeWords(string input)
    {
        if (string.IsNullOrWhiteSpace(input)) return input;

        var cultureInfo = System.Globalization.CultureInfo.CurrentCulture;
        return cultureInfo.TextInfo.ToTitleCase(input.ToLower());
    }
}
