@page "/ManageBranch"
@layout StaffLayout
@inject NavigationManager NavigationManager
@inject IBranchService BranchService

<MudContainer MaxWidth="MaxWidth.Medium" Class="my-5">
    <MudText Typo="Typo.h4" Align="Align.Center" Style="color: #1B7D84;">
        Branch Management
    </MudText>
    <MudCard Class="mt-4">
        <MudCardContent>
            <!-- Add Branch Button -->
            <div style="display: flex; justify-content: flex-end; margin-bottom: 20px;">
                <MudButton Variant="Variant.Filled" Color="Color.Primary" OnClick="NavigateToAddBranch"
                           Style="background-color: #1B7D84; color: white; font-size: 1rem; padding: 8px 16px;">
                    Add Branch
                </MudButton>
            </div>

            
            <!-- Branch Table -->
            <MudTable Items="branches" T="Branch" Hover="true" Bordered="true" Striped="true" Elevation="2">
                <HeaderContent>
                    <MudTh>Branch ID</MudTh>
                    <MudTh>Branch Name</MudTh>
                    <MudTh>Location</MudTh>
                    <MudTh>Actions</MudTh>
                </HeaderContent>
                <RowTemplate>
                    <MudTd>@context.BID</MudTd>
                    <MudTd>@context.BranchName</MudTd>
                    <MudTd>@context.Location</MudTd>
                    <MudTd>
                        <!-- View Button -->
                        <MudIconButton Icon="@Icons.Material.Filled.Visibility" Color="Color.Info" OnClick="() => ViewBranch(context.BID)" />
                        <!-- Edit Button -->
                        <MudIconButton Icon="@Icons.Material.Filled.Edit" OnClick="() => NavigateToAddBranch(context.BID)" />
                        <!-- Delete Button -->
                        <MudIconButton Icon="@Icons.Material.Filled.Delete" Color="Color.Error" OnClick="() => DeleteBranch(context.BID)" />
                    </MudTd>
                </RowTemplate>
                <NoRecordsContent>
                    <MudText Typo="Typo.body1" Align="Align.Center" Style="color: gray;">
                        No branches found.
                    </MudText>
                </NoRecordsContent>
            </MudTable>
        </MudCardContent>
    </MudCard>
</MudContainer>

@code {
    private List<Branch> branches = new List<Branch>();

    protected override void OnInitialized()
    {
        // Load branches on initialization
        branches = BranchService.GetAllBranches().ToList();
    }

    private void AddBranch()
    {
        // Navigate to the AddBranch page
        NavigationManager.NavigateTo("/AddBranch");
    }
    private void NavigateToAddBranch()
    {
        NavigationManager.NavigateTo("/AddBranch");
    }
    private void NavigateToAddBranch(int? branchId = null)
    {
        if (branchId.HasValue)
        {
            NavigationManager.NavigateTo($"/AddBranch/{branchId.Value}");
        }
        else
        {
            NavigationManager.NavigateTo("/AddBranch");
        }
    }

    private void EditBranch(int branchId)
    {
        // Navigate to the EditBranch page with the branch ID
        NavigationManager.NavigateTo($"/EditBranch/{branchId}");
    }

    private void DeleteBranch(int branchId)
    {
        BranchService.SetBranchStatus(branchId, false);
        branches = BranchService.GetAllBranches().ToList();
    }

    private void ViewBranch(int branchId)
    {
        // Navigate to the ViewBranch page with the branch ID
        NavigationManager.NavigateTo($"/ViewBranch/{branchId}");
    }
}
