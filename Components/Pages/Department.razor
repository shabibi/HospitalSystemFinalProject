@page "/Department"
@inject NavigationManager NavigationManager
@inject IDepartmentService DepartmentService

<PageTitle>Departments</PageTitle>

<MudText Typo="Typo.h2" Style="color: #33BEC8; text-align: center; font-family: 'Times New Roman', Times, serif;">
    ATA Hospital Departments
</MudText>
<div Style="display: flex; flex-wrap: wrap; justify-content: center; gap: 16px;">
    @foreach (var department in departments)
    {
        <MudCard Style="width: 250px; height: 400px; display: flex; flex-direction: column; justify-content: space-between;">
            <MudCardMedia Image="@department.Image" Height="150" />
            <MudCardContent>
                <MudText Typo="Typo.h5" Style="font-size: 1.2rem; text-align: center;">@department.DepartmentName</MudText>
                <MudText Typo="Typo.body2" Style="text-align: center; font-size: 0.9rem;">@department.Description</MudText>
            </MudCardContent>
            <MudCardActions Style="display: flex; justify-content: center;">
                <MudButton Variant="Variant.Text"
                           Color="Color.Primary"
                           OnClick="@(() => NavigateToBranch(department.DepartmentId))"
                           Style="margin: auto;">
                    View Details
                </MudButton>
            </MudCardActions>
        </MudCard>
    }
</div>

@code {
    private List<DepartmentViewModel> departments = new();

    protected override void OnInitialized()
    {
        // Fetch all departments
        var departmentDtos = DepartmentService.GetAllDepartments().ToList();

        // Map to ViewModel
        departments = departmentDtos.Select(dept => new DepartmentViewModel
            {
                DepartmentId = dept.DepId,
                DepartmentName = dept.DepartmentName,
                Description = dept.Description,
                Image = $"Images/IconDep/{dept.DepartmentName.ToLower().Replace(" ", "")}.png"
            }).ToList();
    }

    private void NavigateToBranch(int departmentId)
    {
        NavigationManager.NavigateTo($"/DepartmentBranch/{departmentId}");
    }

    private class DepartmentViewModel
    {
        public int DepartmentId { get; set; }
        public string DepartmentName { get; set; }
        public string Description { get; set; }
        public string Image { get; set; }
    }
}
